AmCharts.AmFunnelChart=AmCharts.Class({inherits:AmCharts.AmSlicedChart,construct:function(t){this.type="funnel",AmCharts.AmFunnelChart.base.construct.call(this,t),this.cname="AmFunnelChart",this.startX=this.startY=0,this.baseWidth="100%",this.neckHeight=this.neckWidth=0,this.rotate=!1,this.valueRepresents="height",this.pullDistance=30,this.labelPosition="center",this.labelText="[[title]]: [[value]]",this.balloonText="[[title]]: [[value]]\n[[description]]",AmCharts.applyTheme(this,t,this.cname)},drawChart:function(){AmCharts.AmFunnelChart.base.drawChart.call(this);var t=this.chartData;if(AmCharts.ifArray(t))if(0<this.realWidth&&0<this.realHeight){var e=this.container,a=this.startDuration,i=this.rotate,h=this.updateWidth();this.realWidth=h;var s=this.updateHeight();this.realHeight=s;var r=AmCharts.toCoordinate,l=r(this.marginLeft,h),n=r(this.marginRight,h),o=r(this.marginTop,s)+this.getTitleHeight(),r=r(this.marginBottom,s),n=h-l-n,d=AmCharts.toCoordinate(this.baseWidth,n),c=AmCharts.toCoordinate(this.neckWidth,n),p=s-r-o,C=AmCharts.toCoordinate(this.neckHeight,p),g=o+p-C;i&&(o=s-r,g=o-p+C),this.firstSliceY=o,AmCharts.VML&&(this.startAlpha=1);for(var u=n/2+l,m=(p-C)/((d-c)/2),b=d/2,d=(p-C)*(d+c)/2+c*C,A=o,f=0,C=0;C<t.length;C++){var v,x=t[C];if(!0!==x.hidden){var y,T=[],B=[];if("height"==this.valueRepresents)y=p*x.percents/100;else{var H=-d*x.percents/100/2,Y=b;v=-1/(2*m),y=Math.pow(Y,2)-4*v*H,0>y&&(y=0),y=(Math.sqrt(y)-Y)/(2*v),!i&&o>=g||i&&g>=o?y=2*-H/c:(!i&&o+y>g||i&&g>o-y)&&(v=Math.round(i?y+(o-y-g):y-(o+y-g)),y=v/m,y=v+2*(-H-(Y-y/2)*v)/c)}if(H=b-y/m,Y=!1,!i&&o+y>g||i&&g>o-y?(H=c/2,T.push(u-b,u+b,u+H,u+H,u-H,u-H),i?(v=y+(o-y-g),g>o&&(v=0),B.push(o,o,o-v,o-y,o-y,o-v,o)):(v=y-(o+y-g),o>g&&(v=0),B.push(o,o,o+v,o+y,o+y,o+v,o)),Y=!0):(T.push(u-b,u+b,u+H,u-H),i?B.push(o,o,o-y,o-y):B.push(o,o,o+y,o+y)),e.set(),v=e.set(),T=AmCharts.polygon(e,T,B,x.color,x.alpha,this.outlineThickness,this.outlineColor,this.outlineAlpha),v.push(T),this.graphsSet.push(v),x.wedge=v,x.index=C,B=this.gradientRatio){var L,W=[];for(L=0;L<B.length;L++)W.push(AmCharts.adjustLuminosity(x.color,B[L]));0<W.length&&T.gradient("linearGradient",W),x.pattern&&T.pattern(x.pattern)}a>0&&(this.chartCreated||v.setAttr("opacity",this.startAlpha)),this.addEventListeners(v,x),x.ty0=o-y/2,this.labelsEnabled&&this.labelText&&x.percents>=this.hideLabelsPercent&&(B=this.formatString(this.labelText,x),(T=this.labelFunction)&&(B=T(x,B)),W=x.labelColor,W||(W=this.color),T=this.labelPosition,L="left","center"==T&&(L="middle"),"left"==T&&(L="right"),B=AmCharts.wrappedText(e,B,W,this.fontFamily,this.fontSize,L,!1,this.maxLabelWidth),B.node.style.pointerEvents="none",v.push(B),W=u,i?(L=o-y/2,x.ty0=L):(L=o+y/2,x.ty0=L,A+f+5>L&&(L=A+f+5),L>s-r&&(L=s-r)),"right"==T&&(W=n+10+l,x.tx0=u+(b-y/2/m),Y&&(x.tx0=u+H)),"left"==T&&(x.tx0=u-(b-y/2/m),Y&&(x.tx0=u-H),W=l),x.label=B,x.labelX=W,x.labelY=L,x.labelHeight=B.getBBox().height,B.translate(W,L),b=B.getBBox(),A=AmCharts.rect(e,b.width+5,b.height+5,"#ffffff",.005),A.translate(W+b.x,L+b.y),v.push(A),x.hitRect=A,f=B.getBBox().height,A=L),(0===x.alpha||a>0&&!this.chartCreated)&&v.hide(),o=i?o-y:o+y,b=H,x.startX=AmCharts.toCoordinate(this.startX,h),x.startY=AmCharts.toCoordinate(this.startY,s),x.pullX=AmCharts.toCoordinate(this.pullDistance,h),x.pullY=0,x.balloonX=u,x.balloonY=x.ty0}}this.arrangeLabels(),this.initialStart(),(t=this.legend)&&t.invalidateSize()}else this.cleanChart();this.dispDUpd(),this.chartCreated=!0},arrangeLabels:function(){var t,e=this.rotate;t=e?0:this.realHeight;for(var a,i=0,h=this.chartData,s=h.length,r=0;s>r;r++){a=h[s-r-1];var l=a.label,n=a.labelY,o=a.labelX,d=a.labelHeight,c=n;if(e?t+i+5>n&&(c=t+i+5):n+d+5>t&&(c=t-5-d),t=c,i=d,l){l.translate(o,c);var p=l.getBBox()}a.hitRect.translate(o+p.x,c+p.y),a.labelY=c,a.tx=o,a.ty=c,a.tx2=o}"center"!=this.labelPosition&&this.drawTicks()}});