AmCharts.AmXYChart=AmCharts.Class({inherits:AmCharts.AmRectangularChart,construct:function(t){this.type="xy",AmCharts.AmXYChart.base.construct.call(this,t),this.cname="AmXYChart",this.theme=t,this.createEvents("zoomed"),this.maxZoomFactor=20,AmCharts.applyTheme(this,t,this.cname)},initChart:function(){AmCharts.AmXYChart.base.initChart.call(this),this.dataChanged&&(this.updateData(),this.dataChanged=!1,this.dispatchDataUpdated=!0),this.updateScrollbar=!0,this.drawChart(),this.autoMargins&&!this.marginsUpdated&&(this.marginsUpdated=!0,this.measureMargins());var t=this.marginLeftReal,i=this.marginTopReal,s=this.plotAreaWidth,a=this.plotAreaHeight;this.graphsSet.clipRect(t,i,s,a),this.bulletSet.clipRect(t,i,s,a),this.trendLinesSet.clipRect(t,i,s,a)},prepareForExport:function(){var t=this.bulletSet;t.clipPath&&this.container.remove(t.clipPath)},createValueAxes:function(){var t=[],i=[];this.xAxes=t,this.yAxes=i;var s,a,r=this.valueAxes;for(a=0;a<r.length;a++){s=r[a];var h=s.position;("top"==h||"bottom"==h)&&(s.rotate=!0),s.setOrientation(s.rotate),h=s.orientation,"V"==h&&i.push(s),"H"==h&&t.push(s)}for(0===i.length&&(s=new AmCharts.ValueAxis(this.theme),s.rotate=!1,s.setOrientation(!1),r.push(s),i.push(s)),0===t.length&&(s=new AmCharts.ValueAxis(this.theme),s.rotate=!0,s.setOrientation(!0),r.push(s),t.push(s)),a=0;a<r.length;a++)this.processValueAxis(r[a],a);for(t=this.graphs,a=0;a<t.length;a++)this.processGraph(t[a],a)},drawChart:function(){if(AmCharts.AmXYChart.base.drawChart.call(this),AmCharts.ifArray(this.chartData)?(this.chartScrollbar&&this.updateScrollbars(),this.zoomChart()):this.cleanChart(),this.hideXScrollbar){var t=this.scrollbarH;t&&(this.removeListener(t,"zoomed",this.handleHSBZoom),t.destroy()),this.scrollbarH=null}this.hideYScrollbar&&((t=this.scrollbarV)&&(this.removeListener(t,"zoomed",this.handleVSBZoom),t.destroy()),this.scrollbarV=null),(!this.autoMargins||this.marginsUpdated)&&(this.dispDUpd(),this.chartCreated=!0,this.zoomScrollbars())},cleanChart:function(){AmCharts.callMethod("destroy",[this.valueAxes,this.graphs,this.scrollbarV,this.scrollbarH,this.chartCursor])},zoomChart:function(){this.toggleZoomOutButton(),this.zoomObjects(this.valueAxes),this.zoomObjects(this.graphs),this.zoomTrendLines(),this.dispatchAxisZoom()},toggleZoomOutButton:function(){this.showZB(1==this.heightMultiplier&&1==this.widthMultiplier?!1:!0)},dispatchAxisZoom:function(){var t,i=this.valueAxes;for(t=0;t<i.length;t++){var s=i[t];if(!isNaN(s.min)&&!isNaN(s.max)){var a,r;if("V"==s.orientation?(a=s.coordinateToValue(-this.verticalPosition),r=s.coordinateToValue(-this.verticalPosition+this.plotAreaHeight)):(a=s.coordinateToValue(-this.horizontalPosition),r=s.coordinateToValue(-this.horizontalPosition+this.plotAreaWidth)),!isNaN(a)&&!isNaN(r)){if(a>r){var h=r;r=a,a=h}s.dispatchZoomEvent(a,r)}}}},zoomObjects:function(t){var i,s=t.length;for(i=0;s>i;i++){var a=t[i];this.updateObjectSize(a),a.zoom(0,this.chartData.length-1)}},updateData:function(){this.parseData();var t,i,s=this.chartData,a=s.length-1,r=this.graphs,h=this.dataProvider,e=-1/0,o=1/0;for(t=0;t<r.length;t++)if(i=r[t],i.data=s,i.zoom(0,a),i=i.valueField){var l;for(l=0;l<h.length;l++){var n=Number(h[l][i]);n>e&&(e=n),o>n&&(o=n)}}for(t=0;t<r.length;t++)i=r[t],i.maxValue=e,i.minValue=o;(s=this.chartCursor)&&(s.updateData(),s.type="crosshair",s.valueBalloonsEnabled=!1)},zoomOut:function(){this.verticalPosition=this.horizontalPosition=0,this.heightMultiplier=this.widthMultiplier=1,this.zoomChart(),this.zoomScrollbars()},processValueAxis:function(t){t.chart=this,t.minMaxField="H"==t.orientation?"x":"y",t.minTemp=0/0,t.maxTemp=0/0,this.listenTo(t,"axisSelfZoomed",this.handleAxisSelfZoom)},processGraph:function(t){AmCharts.isString(t.xAxis)&&(t.xAxis=this.getValueAxisById(t.xAxis)),AmCharts.isString(t.yAxis)&&(t.yAxis=this.getValueAxisById(t.yAxis)),t.xAxis||(t.xAxis=this.xAxes[0]),t.yAxis||(t.yAxis=this.yAxes[0]),t.valueAxis=t.yAxis},parseData:function(){AmCharts.AmXYChart.base.parseData.call(this),this.chartData=[];var t,i=this.dataProvider,s=this.valueAxes,a=this.graphs;if(i)for(t=0;t<i.length;t++){var r,h={axes:{},x:{},y:{}},e=i[t];for(r=0;r<s.length;r++){var o=s[r].id;h.axes[o]={},h.axes[o].graphs={};var l;for(l=0;l<a.length;l++){var n=a[l],c=n.id;if(n.xAxis.id==o||n.yAxis.id==o){var u={};u.serialDataItem=h,u.index=t;var m={},d=Number(e[n.valueField]);isNaN(d)||(m.value=d),d=Number(e[n.xField]),isNaN(d)||(m.x=d),d=Number(e[n.yField]),isNaN(d)||(m.y=d),d=Number(e[n.errorField]),isNaN(d)||(m.error=d),u.values=m,this.processFields(n,u,e),u.serialDataItem=h,u.graph=n,h.axes[o].graphs[c]=u}}}this.chartData[t]=h}},formatString:function(t,i,s){var a=i.graph.numberFormatter;return a||(a=this.nf),t=AmCharts.formatValue(t,i.values,["value","x","y"],a),-1!=t.indexOf("[[")&&(t=AmCharts.formatDataContextValue(t,i.dataContext)),t=AmCharts.AmXYChart.base.formatString.call(this,t,i,s)},addChartScrollbar:function(t){if(AmCharts.callMethod("destroy",[this.chartScrollbar,this.scrollbarH,this.scrollbarV]),t){this.chartScrollbar=t,this.scrollbarHeight=t.scrollbarHeight;var i="backgroundColor backgroundAlpha selectedBackgroundColor selectedBackgroundAlpha scrollDuration resizeEnabled hideResizeGrips scrollbarHeight updateOnReleaseOnly".split(" ");if(!this.hideYScrollbar){var s=new AmCharts.SimpleChartScrollbar(this.theme);s.skipEvent=!0,s.chart=this,this.listenTo(s,"zoomed",this.handleVSBZoom),AmCharts.copyProperties(t,s,i),s.rotate=!0,this.scrollbarV=s}this.hideXScrollbar||(s=new AmCharts.SimpleChartScrollbar(this.theme),s.skipEvent=!0,s.chart=this,this.listenTo(s,"zoomed",this.handleHSBZoom),AmCharts.copyProperties(t,s,i),s.rotate=!1,this.scrollbarH=s)}},updateTrendLines:function(){var t,i=this.trendLines;for(t=0;t<i.length;t++){var s=i[t],s=AmCharts.processObject(s,AmCharts.TrendLine,this.theme);i[t]=s,s.chart=this;var a=s.valueAxis;AmCharts.isString(a)&&(s.valueAxis=this.getValueAxisById(a)),a=s.valueAxisX,AmCharts.isString(a)&&(s.valueAxisX=this.getValueAxisById(a)),s.valueAxis||(s.valueAxis=this.yAxes[0]),s.valueAxisX||(s.valueAxisX=this.xAxes[0])}},updateMargins:function(){AmCharts.AmXYChart.base.updateMargins.call(this);var t=this.scrollbarV;t&&(this.getScrollbarPosition(t,!0,this.yAxes[0].position),this.adjustMargins(t,!0)),(t=this.scrollbarH)&&(this.getScrollbarPosition(t,!1,this.xAxes[0].position),this.adjustMargins(t,!1))},updateScrollbars:function(){AmCharts.AmXYChart.base.updateScrollbars.call(this);var t=this.scrollbarV;t&&(this.updateChartScrollbar(t,!0),t.draw()),(t=this.scrollbarH)&&(this.updateChartScrollbar(t,!1),t.draw())},zoomScrollbars:function(){var t=this.scrollbarH;t&&t.relativeZoom(this.widthMultiplier,-this.horizontalPosition/this.widthMultiplier),(t=this.scrollbarV)&&t.relativeZoom(this.heightMultiplier,-this.verticalPosition/this.heightMultiplier)},fitMultiplier:function(t){return t>this.maxZoomFactor&&(t=this.maxZoomFactor),t},handleHSBZoom:function(t){var i=this.fitMultiplier(t.multiplier);t=-t.position*i;var s=-(this.plotAreaWidth*i-this.plotAreaWidth);s>t&&(t=s),this.widthMultiplier=i,this.horizontalPosition=t,this.zoomChart()},handleVSBZoom:function(t){var i=this.fitMultiplier(t.multiplier);t=-t.position*i;var s=-(this.plotAreaHeight*i-this.plotAreaHeight);s>t&&(t=s),this.heightMultiplier=i,this.verticalPosition=t,this.zoomChart()},handleAxisSelfZoom:function(t){if("H"==t.valueAxis.orientation){var i=this.fitMultiplier(t.multiplier);t=-t.position*i;var s=-(this.plotAreaWidth*i-this.plotAreaWidth);s>t&&(t=s),this.horizontalPosition=t,this.widthMultiplier=i}else i=this.fitMultiplier(t.multiplier),t=-t.position*i,s=-(this.plotAreaHeight*i-this.plotAreaHeight),s>t&&(t=s),this.verticalPosition=t,this.heightMultiplier=i;for(this.zoomChart(),i=this.graphs,t=0;t<i.length;t++)i[t].setAnimationPlayed();this.zoomScrollbars()},handleCursorZoom:function(t){var i=this.widthMultiplier*this.plotAreaWidth/t.selectionWidth,s=this.heightMultiplier*this.plotAreaHeight/t.selectionHeight,i=this.fitMultiplier(i),s=this.fitMultiplier(s);this.horizontalPosition=(this.horizontalPosition-t.selectionX)*i/this.widthMultiplier,this.verticalPosition=(this.verticalPosition-t.selectionY)*s/this.heightMultiplier,this.widthMultiplier=i,this.heightMultiplier=s,this.zoomChart(),this.zoomScrollbars()},removeChartScrollbar:function(){AmCharts.callMethod("destroy",[this.scrollbarH,this.scrollbarV]),this.scrollbarV=this.scrollbarH=null},handleReleaseOutside:function(t){AmCharts.AmXYChart.base.handleReleaseOutside.call(this,t),AmCharts.callMethod("handleReleaseOutside",[this.scrollbarH,this.scrollbarV])}});