AmCharts.AmPieChart=AmCharts.Class({inherits:AmCharts.AmSlicedChart,construct:function(t){this.type="pie",AmCharts.AmPieChart.base.construct.call(this,t),this.cname="AmPieChart",this.pieBrightnessStep=30,this.minRadius=10,this.depth3D=0,this.startAngle=90,this.angle=this.innerRadius=0,this.startRadius="500%",this.pullOutRadius="20%",this.labelRadius=20,this.labelText="[[title]]: [[percents]]%",this.balloonText="[[title]]: [[percents]]% ([[value]])\n[[description]]",this.previousScale=1,AmCharts.applyTheme(this,t,this.cname)},drawChart:function(){AmCharts.AmPieChart.base.drawChart.call(this);var t=this.chartData;if(AmCharts.ifArray(t)){if(0<this.realWidth&&0<this.realHeight){AmCharts.VML&&(this.startAlpha=1);var i=this.startDuration,e=this.container,a=this.updateWidth();this.realWidth=a;var h=this.updateHeight();this.realHeight=h;var s,r,l,n=AmCharts.toCoordinate,d=n(this.marginLeft,a),o=n(this.marginRight,a),p=n(this.marginTop,h)+this.getTitleHeight(),u=n(this.marginBottom,h),c=AmCharts.toNumber(this.labelRadius),g=this.measureMaxLabel();for(g>this.maxLabelWidth&&(g=this.maxLabelWidth),this.labelText&&this.labelsEnabled||(c=g=0),s=void 0===this.pieX?(a-d-o)/2+d:n(this.pieX,this.realWidth),r=void 0===this.pieY?(h-p-u)/2+p:n(this.pieY,h),l=n(this.radius,a,h),l||(a=c>=0?a-d-o-2*g:a-d-o,h=h-p-u,l=Math.min(a,h),a>h&&(l/=1-this.angle/90,l>a&&(l=a)),h=AmCharts.toCoordinate(this.pullOutRadius,l),l=(c>=0?l-1.8*(c+h):l-1.8*h)/2),l<this.minRadius&&(l=this.minRadius),h=n(this.pullOutRadius,l),p=AmCharts.toCoordinate(this.startRadius,l),n=n(this.innerRadius,l),n>=l&&(n=l-1),u=AmCharts.fitToBounds(this.startAngle,0,360),0<this.depth3D&&(u=u>=270?270:90),u-=90,a=l-l*this.angle/90,d=0;d<t.length;d++)if(o=t[d],!0!==o.hidden&&0<o.percents){var m=360*o.percents/100,g=Math.sin((u+m/2)/180*Math.PI),b=-Math.cos((u+m/2)/180*Math.PI)*(a/l),C=this.outlineColor;C||(C=o.color);var v=this.alpha;if(isNaN(o.alpha)||(v=o.alpha),C={fill:o.color,stroke:C,"stroke-width":this.outlineThickness,"stroke-opacity":this.outlineAlpha,"fill-opacity":v},o.url&&(C.cursor="pointer"),C=AmCharts.wedge(e,s,r,u,m,l,a,n,this.depth3D,C,this.gradientRatio,o.pattern),this.addEventListeners(C,o),o.startAngle=u,t[d].wedge=C,i>0&&(this.chartCreated||C.setAttr("opacity",this.startAlpha)),o.ix=g,o.iy=b,o.wedge=C,o.index=d,this.labelsEnabled&&this.labelText&&o.percents>=this.hideLabelsPercent){var A=u+m/2;A>360&&(A-=360);var f=c;isNaN(o.labelRadius)||(f=o.labelRadius);var R,m=s+g*(l+f),v=r+b*(l+f),x=0;if(f>=0){var y;90>=A&&A>=0?(y=0,R="start",x=8):A>=90&&180>A?(y=1,R="start",x=8):A>=180&&270>A?(y=2,R="end",x=-8):A>=270&&360>A&&(y=3,R="end",x=-8),o.labelQuarter=y}else R="middle";var A=this.formatString(this.labelText,o),k=this.labelFunction;k&&(A=k(o,A)),k=o.labelColor,k||(k=this.color),A=AmCharts.wrappedText(e,A,k,this.fontFamily,this.fontSize,R,!1,this.maxLabelWidth),A.translate(m+1.5*x,v),A.node.style.pointerEvents="none",o.tx=m+1.5*x,o.ty=v,f>=0?(f=A.getBBox(),k=AmCharts.rect(e,f.width+5,f.height+5,"#FFFFFF",.005),k.translate(m+1.5*x+f.x,v+f.y),o.hitRect=k,C.push(A),C.push(k)):this.freeLabelsSet.push(A),o.label=A,o.tx=m,o.tx2=m+x,o.tx0=s+g*l,o.ty0=r+b*l}m=n+(l-n)/2,o.pulled&&(m+=this.pullOutRadiusReal),o.balloonX=g*m+s,o.balloonY=b*m+r,o.startX=Math.round(g*p),o.startY=Math.round(b*p),o.pullX=Math.round(g*h),o.pullY=Math.round(b*h),this.graphsSet.push(C),(0===o.alpha||i>0&&!this.chartCreated)&&C.hide(),u+=360*o.percents/100}c>0&&!this.labelRadiusField&&this.arrangeLabels(),this.pieXReal=s,this.pieYReal=r,this.radiusReal=l,this.innerRadiusReal=n,c>0&&this.drawTicks(),this.initialStart(),this.setDepths()}(t=this.legend)&&t.invalidateSize()}else this.cleanChart();this.dispDUpd(),this.chartCreated=!0},setDepths:function(){var t,i=this.chartData;for(t=0;t<i.length;t++){var e=i[t],a=e.wedge,e=e.startAngle;e>=0&&180>e?a.toFront():e>=180&&a.toBack()}},arrangeLabels:function(){var t,i,e=this.chartData,a=e.length;for(i=a-1;i>=0;i--)t=e[i],0!==t.labelQuarter||t.hidden||this.checkOverlapping(i,t,0,!0,0);for(i=0;a>i;i++)t=e[i],1!=t.labelQuarter||t.hidden||this.checkOverlapping(i,t,1,!1,0);for(i=a-1;i>=0;i--)t=e[i],2!=t.labelQuarter||t.hidden||this.checkOverlapping(i,t,2,!0,0);for(i=0;a>i;i++)t=e[i],3!=t.labelQuarter||t.hidden||this.checkOverlapping(i,t,3,!1,0)},checkOverlapping:function(t,i,e,a,h){var s,r,l=this.chartData,n=l.length,d=i.label;if(d){if(!0===a)for(r=t+1;n>r;r++)l[r].labelQuarter==e&&(s=this.checkOverlappingReal(i,l[r],e))&&(r=n);else for(r=t-1;r>=0;r--)l[r].labelQuarter==e&&(s=this.checkOverlappingReal(i,l[r],e))&&(r=0);!0===s&&100>h&&(s=i.ty+3*i.iy,i.ty=s,d.translate(i.tx2,s),i.hitRect&&(d=d.getBBox(),i.hitRect.translate(i.tx2+d.x,s+d.y)),this.checkOverlapping(t,i,e,a,h+1))}},checkOverlappingReal:function(t,i,e){var a=!1,h=t.label,s=i.label;return t.labelQuarter!=e||t.hidden||i.hidden||!s||(h=h.getBBox(),e={},e.width=h.width,e.height=h.height,e.y=t.ty,e.x=t.tx,t=s.getBBox(),s={},s.width=t.width,s.height=t.height,s.y=i.ty,s.x=i.tx,AmCharts.hitTest(e,s)&&(a=!0)),a}});